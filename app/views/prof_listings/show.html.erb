<% content_for(:content_title) do %>
  <h1><%= h @course.title %> <small><%= h @course.instructor %></small></h1>
<% end %>
<% content_for(:content_title_links) do %>
  <a href="<%= new_prof_listing_new_request_path(@course.id) %>" class="btn">New Request</a>
<% end %>

<% # breadcrumb([ link_to('Courses', 'student_courses'), 'Course 1']) %>
<table class="table table-striped find-resources datatable">
  <thead>
    <tr>
      <th>Reserve</th>
      <th></th>
      <th class="topic_row">Topics</th>
      <th>Status</th>
      <th>Copy</th>
    </tr>
  </thead>
  <tbody>
    <% @course.reserves.each do | reserve | %>
      <%= render :partial => '/external/request/lists/instructor_list_row', :locals => { object: reserve } %>
    <% end %>
  </tbody>
</table>

<div class="modal hide" id="topic_form">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal">Ã—</button>
    <h3>Add Topic</h3>
  </div>
  <div class="modal-body">
    <form>
      <fieldset id="topic_list">
        <legend>Topics</legend>
        <label class="checkbox"><input type="checkbox"> Topic 1</label>
        <label class="checkbox"><input type="checkbox"> Topic 2</label>
      </fieldset>

      <fieldset>
        <legend>New Topic</legend>

        <label><input type="text" id="add_topic_input"> <a href="#" class="btn" id="add_topic_button">Add</a></label>
      </fieldset>
    </form>
  </div>
  <div class="modal-footer">
    <a href="#" class="btn btn-primary" data-dismiss="modal">Save changes</a>
    <a href="#" class="btn" data-dismiss="modal">Close</a>
  </div>
</div>

<div id="copy-overlay">
  <form action="<%= prof_listing_copy_course_listings_path(@course.id) %>" method="post">
    <h4>Copy Material to a New Course</h4>
    <ul id="">
    </ul>
    <br />
    <select id="copy_to_select">
      <option>Copy to Course</option>
      <optgroup label="Current Semester">
        <option>Course 1</option>
        <option>Course 2</option>
      </optgroup>
      <optgroup label="Next Semester">
        <option>Course 3</option>
        <option>Course 4</option>
      </optgroup>
    </select>
    <button type="submit" class="copy btn btn-primary">Copy Material</button>
    <button class="cancel btn">Cancel</button>
  </form>
</div>

<style>
  #copy-overlay {
    display: none;
    padding: 25px 25px 5px 25px;
    position: fixed;
    right: 10px;
    bottom: 0px;
    background-color: white;
    border: 4px black solid;
  }

</style>

<script type="text/javascript">
  $(document).ready(function () {

    // For fluid containers
    oTable = $('.datatable').dataTable({
      "sPaginationType": "bootstrap",
      "iDisplayLength": 1000,
      "bLengthChange": false,
      "aoColumnDefs": [ { "bVisible": true, "aTargets": [ 2 ] }, { "bSortable":false, "bSearchable": false, "aTargets": [ 1 ]} ]
    });

    var input = $('.dataTables_filter').addClass('well form-vertical ').find('input');
    input.attr('placeholder', "Author name or Title");
    input.attr('data-content', 'Start typeing to filter the list');
    input.attr('data-title', 'Reserve Filter');

    input.popover({ trigger: 'manual' })

    input.focus(function () {

      if ($(this).attr('data-popover-shown') != 'shown') {
        var input = $(this);

        setTimeout(function () { input.popover('show'); }, 2000);
        input.attr('data-popover-shown', 'shown');
      }

      return true;
    });

    input.blur(function () {
      $(this).popover('hide');
    });

    input.keyup(function () {
      $(this).popover('hide');
    });

    txt = '<label>Filter by Topic: <select id="search_filter"><option></option><%= escape_javascript(options_for_select(@course.all_tags)) %></select></label><label>Filter by Status: <select id="status_filter"><option value=""></option><option value="New">New</option><option value="Awaiting">Awaiting Action</option><option value="Complete">Complete</option></select></label>';

    input.focus();

    $('.dataTables_filter').append(txt);
    $('#search_filter').change(function () {
      oTable.fnFilter($(this).val(), 2, true, false, false);
    });
    $('#status_filter').change(function () {
      oTable.fnFilter($(this).val(), 3, true, false, false);
    });
    $('#add_topic_button').click(function () {
      $('#topic_list').append('<label class="checkbox"><input type="checkbox" checked="true"> New Topic</label>')
    });

    $('.copy').change(function () {
      txt = $(this).parents('tr').find('.title').text();
      if ($('#copy-overlay ul li:contains('+txt+')').size() > 0) {
        $('#copy-overlay ul li:contains('+txt+')').remove();
      } else {
        row = $('<li>' + txt + '</li>')
        $('#copy-overlay ul').append(row);
        row.effect("highlight", {}, 3000);
      }

      if ($('#copy-overlay ul li').size() == 0) {
        $('#copy-overlay').hide();
      } else {
        $('#copy-overlay').show();
      }
    });

    $('#copy-overlay .cancel').click(function () {
      $('#copy-overlay ul li').remove();
      $('#copy-overlay').hide();
      $('.copy').each(function () {
        this.checked = false;
      });
      return false;
    });

  });

</script>
